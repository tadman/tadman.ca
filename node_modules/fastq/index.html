<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>fastq</title>
    <link rel="stylesheet" media="all" href="/assets/css/main.css"/>
  </head>
  <body class="bg-blue-900 p-8">
    <h1 id="fastq">fastq</h1>

<p><img src="https://github.com/mcollina/fastq/workflows/ci/badge.svg" alt="ci" />
<a href="https://badge.fury.io/js/fastq"><img src="https://badge.fury.io/js/fastq.svg" alt="npm version" /></a>
<a href="https://david-dm.org/mcollina/fastq"><img src="https://david-dm.org/mcollina/fastq.svg" alt="Dependency Status" /></a></p>

<p>Fast, in memory work queue.</p>

<p>Benchmarks (1 million tasks):</p>

<ul>
  <li>setImmediate: 812ms</li>
  <li>fastq: 854ms</li>
  <li>async.queue: 1298ms</li>
  <li>neoAsync.queue: 1249ms</li>
</ul>

<p>Obtained on node 12.16.1, on a dedicated server.</p>

<p>If you need zero-overhead series function call, check out
<a href="http://npm.im/fastseries">fastseries</a>. For zero-overhead parallel
function call, check out <a href="http://npm.im/fastparallel">fastparallel</a>.</p>

<p><a href="https://github.com/feross/standard"><img src="https://raw.githubusercontent.com/feross/standard/master/badge.png" alt="js-standard-style" /></a></p>

<ul>
  <li><a href="#install">Installation</a></li>
  <li><a href="#usage">Usage</a></li>
  <li><a href="#api">API</a></li>
  <li><a href="#license">Licence &amp; copyright</a></li>
</ul>

<h2 id="install">Install</h2>

<p><code class="language-plaintext highlighter-rouge">npm i fastq --save</code></p>

<h2 id="usage-callback-api">Usage (callback API)</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fastq</span><span class="dl">'</span><span class="p">)(</span><span class="nx">worker</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span> <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">the result is</span><span class="dl">'</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">worker</span> <span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="usage-promise-api">Usage (promise API)</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fastq</span><span class="dl">'</span><span class="p">).</span><span class="nx">promise</span><span class="p">(</span><span class="nx">worker</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">worker</span> <span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">arg</span> <span class="o">*</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">run</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">the result is</span><span class="dl">'</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="setting-this">Setting “this”</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{</span> <span class="na">hello</span><span class="p">:</span> <span class="dl">'</span><span class="s1">world</span><span class="dl">'</span> <span class="p">}</span>
<span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fastq</span><span class="dl">'</span><span class="p">)(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">worker</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span> <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">the result is</span><span class="dl">'</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">worker</span> <span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="using-with-typescript-callback-api">Using with TypeScript (callback API)</h3>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">fastq</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fastq</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">queue</span><span class="p">,</span> <span class="nx">done</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fastq</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">Task</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">id</span><span class="p">:</span> <span class="kr">number</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">q</span><span class="p">:</span> <span class="nx">queue</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">fastq</span><span class="p">(</span><span class="nx">worker</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nx">q</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>

<span class="kd">function</span> <span class="nx">worker</span> <span class="p">(</span><span class="nx">arg</span><span class="p">:</span> <span class="nx">Task</span><span class="p">,</span> <span class="nx">cb</span><span class="p">:</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arg</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
  <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="using-with-typescript-promise-api">Using with TypeScript (promise API)</h3>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span>

<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">fastq</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fastq</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">queueAsPromised</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fastq</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">Task</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">id</span><span class="p">:</span> <span class="kr">number</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">q</span><span class="p">:</span> <span class="nx">queueAsPromised</span><span class="o">&lt;</span><span class="nx">Task</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">fastq</span><span class="p">.</span><span class="nx">promise</span><span class="p">(</span><span class="nx">asyncWorker</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nx">q</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">asyncWorker</span> <span class="p">(</span><span class="nx">arg</span><span class="p">:</span> <span class="nx">Task</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// No need for a try-catch block, fastq handles errors automatically</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arg</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="api">API</h2>

<ul>
  <li><a href="#fastqueue"><code>fastqueue()</code></a></li>
  <li><a href="#push"><code>queue#<b>push()</b></code></a></li>
  <li><a href="#unshift"><code>queue#<b>unshift()</b></code></a></li>
  <li><a href="#pause"><code>queue#<b>pause()</b></code></a></li>
  <li><a href="#resume"><code>queue#<b>resume()</b></code></a></li>
  <li><a href="#idle"><code>queue#<b>idle()</b></code></a></li>
  <li><a href="#length"><code>queue#<b>length()</b></code></a></li>
  <li><a href="#getQueue"><code>queue#<b>getQueue()</b></code></a></li>
  <li><a href="#kill"><code>queue#<b>kill()</b></code></a></li>
  <li><a href="#killAndDrain"><code>queue#<b>killAndDrain()</b></code></a></li>
  <li><a href="#error"><code>queue#<b>error()</b></code></a></li>
  <li><a href="#concurrency"><code>queue#<b>concurrency</b></code></a></li>
  <li><a href="#drain"><code>queue#<b>drain</b></code></a></li>
  <li><a href="#empty"><code>queue#<b>empty</b></code></a></li>
  <li><a href="#saturated"><code>queue#<b>saturated</b></code></a></li>
  <li><a href="#promise"><code>fastqueue.promise()</code></a></li>
</ul>

<hr />
<p><a name="fastqueue"></a></p>
<h3 id="fastqueuethat-worker-concurrency">fastqueue([that], worker, concurrency)</h3>

<p>Creates a new queue.</p>

<p>Arguments:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">that</code>, optional context of the <code class="language-plaintext highlighter-rouge">worker</code> function.</li>
  <li><code class="language-plaintext highlighter-rouge">worker</code>, worker function, it would be called with <code class="language-plaintext highlighter-rouge">that</code> as <code class="language-plaintext highlighter-rouge">this</code>,
if that is specified.</li>
  <li><code class="language-plaintext highlighter-rouge">concurrency</code>, number of concurrent tasks that could be executed in
parallel.</li>
</ul>

<hr />
<p><a name="push"></a></p>
<h3 id="queuepushtask-done">queue.push(task, done)</h3>

<p>Add a task at the end of the queue. <code class="language-plaintext highlighter-rouge">done(err, result)</code> will be called
when the task was processed.</p>

<hr />
<p><a name="unshift"></a></p>
<h3 id="queueunshifttask-done">queue.unshift(task, done)</h3>

<p>Add a task at the beginning of the queue. <code class="language-plaintext highlighter-rouge">done(err, result)</code> will be called
when the task was processed.</p>

<hr />
<p><a name="pause"></a></p>
<h3 id="queuepause">queue.pause()</h3>

<p>Pause the processing of tasks. Currently worked tasks are not
stopped.</p>

<hr />
<p><a name="resume"></a></p>
<h3 id="queueresume">queue.resume()</h3>

<p>Resume the processing of tasks.</p>

<hr />
<p><a name="idle"></a></p>
<h3 id="queueidle">queue.idle()</h3>

<p>Returns <code class="language-plaintext highlighter-rouge">false</code> if there are tasks being processed or waiting to be processed.
<code class="language-plaintext highlighter-rouge">true</code> otherwise.</p>

<hr />
<p><a name="length"></a></p>
<h3 id="queuelength">queue.length()</h3>

<p>Returns the number of tasks waiting to be processed (in the queue).</p>

<hr />
<p><a name="getQueue"></a></p>
<h3 id="queuegetqueue">queue.getQueue()</h3>

<p>Returns all the tasks be processed (in the queue). Returns empty array when there are no tasks</p>

<hr />
<p><a name="kill"></a></p>
<h3 id="queuekill">queue.kill()</h3>

<p>Removes all tasks waiting to be processed, and reset <code class="language-plaintext highlighter-rouge">drain</code> to an empty
function.</p>

<hr />
<p><a name="killAndDrain"></a></p>
<h3 id="queuekillanddrain">queue.killAndDrain()</h3>

<p>Same than <code class="language-plaintext highlighter-rouge">kill</code> but the <code class="language-plaintext highlighter-rouge">drain</code> function will be called before reset to empty.</p>

<hr />
<p><a name="error"></a></p>
<h3 id="queueerrorhandler">queue.error(handler)</h3>

<p>Set a global error handler. <code class="language-plaintext highlighter-rouge">handler(err, task)</code> will be called
when any of the tasks return an error.</p>

<hr />
<p><a name="concurrency"></a></p>
<h3 id="queueconcurrency">queue.concurrency</h3>

<p>Property that returns the number of concurrent tasks that could be executed in
parallel. It can be altered at runtime.</p>

<hr />
<p><a name="drain"></a></p>
<h3 id="queuedrain">queue.drain</h3>

<p>Function that will be called when the last
item from the queue has been processed by a worker.
It can be altered at runtime.</p>

<hr />
<p><a name="empty"></a></p>
<h3 id="queueempty">queue.empty</h3>

<p>Function that will be called when the last
item from the queue has been assigned to a worker.
It can be altered at runtime.</p>

<hr />
<p><a name="saturated"></a></p>
<h3 id="queuesaturated">queue.saturated</h3>

<p>Function that will be called when the queue hits the concurrency
limit.
It can be altered at runtime.</p>

<hr />
<p><a name="promise"></a></p>
<h3 id="fastqueuepromisethat-workerarg-concurrency">fastqueue.promise([that], worker(arg), concurrency)</h3>

<p>Creates a new queue with <code class="language-plaintext highlighter-rouge">Promise</code> apis. It also offers all the methods
and properties of the object returned by <a href="#fastqueue"><code class="language-plaintext highlighter-rouge">fastqueue</code></a> with the modified
<a href="#pushPromise"><code class="language-plaintext highlighter-rouge">push</code></a> and <a href="#unshiftPromise"><code class="language-plaintext highlighter-rouge">unshift</code></a> methods.</p>

<p>Node v10+ is required to use the promisified version.</p>

<p>Arguments:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">that</code>, optional context of the <code class="language-plaintext highlighter-rouge">worker</code> function.</li>
  <li><code class="language-plaintext highlighter-rouge">worker</code>, worker function, it would be called with <code class="language-plaintext highlighter-rouge">that</code> as <code class="language-plaintext highlighter-rouge">this</code>,
if that is specified. It MUST return a <code class="language-plaintext highlighter-rouge">Promise</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">concurrency</code>, number of concurrent tasks that could be executed in
parallel.</li>
</ul>

<p><a name="pushPromise"></a></p>
<h4 id="queuepushtask--promise">queue.push(task) =&gt; Promise</h4>

<p>Add a task at the end of the queue. The returned <code class="language-plaintext highlighter-rouge">Promise</code>  will be fulfilled (rejected)
when the task is completed successfully (unsuccessfully).</p>

<p>This promise could be ignored as it will not lead to a <code class="language-plaintext highlighter-rouge">'unhandledRejection'</code>.</p>

<p><a name="unshiftPromise"></a></p>
<h4 id="queueunshifttask--promise">queue.unshift(task) =&gt; Promise</h4>

<p>Add a task at the beginning of the queue. The returned <code class="language-plaintext highlighter-rouge">Promise</code>  will be fulfilled (rejected)
when the task is completed successfully (unsuccessfully).</p>

<p>This promise could be ignored as it will not lead to a <code class="language-plaintext highlighter-rouge">'unhandledRejection'</code>.</p>

<p><a name="drained"></a></p>
<h4 id="queuedrained--promise">queue.drained() =&gt; Promise</h4>

<p>Wait for the queue to be drained. The returned <code class="language-plaintext highlighter-rouge">Promise</code> will be resolved when all tasks in the queue have been processed by a worker.</p>

<p>This promise could be ignored as it will not lead to a <code class="language-plaintext highlighter-rouge">'unhandledRejection'</code>.</p>

<h2 id="license">License</h2>

<p>ISC</p>


  </body>
</html>
