<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" media="all" href="/assets/css/main.css"/>
  </head>
  <body class="bg-blue-900 p-8">
    <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

<ul>
  <li><a href="#thenbyjs-usage">thenBy.js usage</a>
    <ul>
      <li><a href="#sort-by-property-names">Sort by property names</a></li>
      <li><a href="#sort-by-unary-functions">Sort by unary functions</a></li>
      <li><a href="#extra-options">Extra options</a>
        <ul>
          <li><a href="#sort-descending">Sort descending</a></li>
          <li><a href="#case-insensitive-sorting">Case insensitive sorting</a></li>
          <li><a href="#custom-compare-function">Custom compare function</a></li>
          <li><a href="#internationalization-using-javascripts-native-intlcollator">Internationalization: Using javascripts native <code class="language-plaintext highlighter-rouge">Intl.Collator</code></a></li>
        </ul>
      </li>
      <li><a href="#a-word-on-performance">A word on performance</a></li>
      <li><a href="#installing">Installing</a>
        <ul>
          <li><a href="#install-in-your-html">Install in your HTML</a></li>
          <li><a href="#install-using-npm-or-yarn">Install using npm or yarn</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<h1 id="thenbyjs-usage">thenBy.js usage</h1>

<p><a href="https://npmjs.org/package/thenby"><img src="https://img.shields.io/npm/v/thenby.svg" alt="NPM Version" /></a>
  <a href="https://npmjs.org/package/thenby"><img src="https://img.shields.io/npm/dm/thenby.svg" alt="NPM Downloads" /></a></p>

<p><code class="language-plaintext highlighter-rouge">thenBy</code> is a javascript micro library that helps sorting arrays on multiple keys. It allows you to use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">native Array::sort() method</a> of javascript, but pass in multiple functions to sort that are composed with <code class="language-plaintext highlighter-rouge">firstBy().thenBy().thenBy()</code> style.</p>

<p>Example:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first by length of name, then by population, then by ID</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
    <span class="nx">firstBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">population</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">population</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">id</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span> <span class="p">})</span>
<span class="p">);</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">thenBy</code> also offers some nice shortcuts that make the most common ways of sorting even easier and more readable.</p>

<h3 id="sort-by-property-names">Sort by property names</h3>
<p>Javascript sorting relies heavily on passing discriminator functions that return -1, 0 or 1 for a pair of items. While this is very flexible, often you want to sort on the value of a simple property. As a convenience, thenBy.js builds the appropriate compare function for you if you pass in a property name (instead of a function). The example above would then look like this:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first by length of name, then by population, then by ID</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
    <span class="nx">firstBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">population</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>If an element doesn’t have the property defined, it will sort like the empty string (“”). Typically, this will be at the top.</p>

<h3 id="sort-by-unary-functions">Sort by unary functions</h3>
<p>You can also pass a function that takes a single item and returns its sorting key. This turns the above expression into:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first by length of name, then by population, then by ID</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
    <span class="nx">firstBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">population</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Note that javascript contains a number of standard functions that can be passed in here as well. The Number() function will make your sorting sort on numeric values instead of lexical values:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">20</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">03</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">-2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="dl">"</span><span class="s2">2</span><span class="dl">"</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">sorted</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">firstBy</span><span class="p">(</span><span class="nb">Number</span><span class="p">));</span>
</code></pre></div></div>
<h2 id="extra-options">Extra options</h2>
<h3 id="sort-descending">Sort descending</h3>
<p>thenBy.js allows you to pass in a second parameter for <code class="language-plaintext highlighter-rouge">direction</code>. If you pass in ‘desc’ or -1, the sorting will be reversed. So:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first by length of name descending, then by population descending, then by ID ascending</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
    <span class="nx">firstBy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">},</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">population</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="case-insensitive-sorting">Case insensitive sorting</h3>
<p>(as of v1.2.0) All of the shortcut methods allow you to sort case insensitive as well. The second parameter expects an options object (if it is a number, it is interpreted as <code class="language-plaintext highlighter-rouge">direction</code> as above). The ignoreCase property can be set to true, like this:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first by name, case insensitive, then by population</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
    <span class="nx">firstBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">ignoreCase</span><span class="p">:</span><span class="kc">true</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">thenBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">population</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>
<p>If you want to use both descending and ignoreCase, you have to use the options syntax for direction as well:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// sort by name, case insensitive and descending</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">firstBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">ignoreCase</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span> <span class="na">direction</span><span class="p">:</span><span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">}));</span>
</code></pre></div></div>
<h3 id="custom-compare-function">Custom compare function</h3>
<p>If you have more specific wishes for the exact sort order, but still want to use the convenience of unary functions or sorting on property names, you can pass in you own compare function in the options. Here we use a compare function that known about the relative values of playing cards::</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cards</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">3</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">4</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">5</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">6</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">7</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">8</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">9</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">10</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">J</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Q</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">K</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">A</span><span class="dl">'</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">cardCompare</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span><span class="p">)</span> <span class="o">=&gt;</span><span class="p">{</span>
    <span class="k">return</span> <span class="nx">cards</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">c1</span><span class="p">)</span> <span class="o">-</span> <span class="nx">cards</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">c2</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">handOfCards</span> <span class="o">=</span>  <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="na">suit</span><span class="p">:</span><span class="dl">"</span><span class="s2">c</span><span class="dl">"</span><span class="p">,</span> <span class="na">card</span><span class="p">:</span><span class="dl">"</span><span class="s2">A</span><span class="dl">"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="na">suit</span><span class="p">:</span><span class="dl">"</span><span class="s2">d</span><span class="dl">"</span><span class="p">,</span> <span class="na">card</span><span class="p">:</span><span class="dl">"</span><span class="s2">10</span><span class="dl">"</span> <span class="p">},</span>
        <span class="c1">// etc</span>
    <span class="p">];</span>
<span class="nx">handOfCards</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">firstBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">card</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">cmp</span><span class="p">:</span> <span class="nx">cardCompare</span><span class="p">,</span> <span class="na">direction</span><span class="p">:</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">}));</span>

</code></pre></div></div>
<p>You can use the <code class="language-plaintext highlighter-rouge">cmp</code> function together with <code class="language-plaintext highlighter-rouge">direction</code>, but not with <code class="language-plaintext highlighter-rouge">ignoreCase</code> (for obvious reasons).</p>

<h3 id="internationalization-using-javascripts-native-intlcollator">Internationalization: Using javascripts native <code class="language-plaintext highlighter-rouge">Intl.Collator</code></h3>
<p>One of the more interesting custom compare functions you may want to pass in is the native <code class="language-plaintext highlighter-rouge">compare</code> function that is exposed by <code class="language-plaintext highlighter-rouge">Intl.Collator</code>. This compare function knows about the different sorting rules in different cultures. Many browsers have these implemented, but in NodeJS, the API is implemented, but only for the English culture. You would use it with thenBy like this:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// in German, ä sorts with a</span>
<span class="kd">var</span> <span class="nx">germanCompare</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Intl</span><span class="p">.</span><span class="nx">Collator</span><span class="p">(</span><span class="dl">'</span><span class="s1">de</span><span class="dl">'</span><span class="p">).</span><span class="nx">compare</span><span class="p">;</span>
<span class="c1">// in Swedish, ä sorts after z</span>
<span class="kd">var</span> <span class="nx">swedishCompare</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Intl</span><span class="p">.</span><span class="nx">Collator</span><span class="p">(</span><span class="dl">'</span><span class="s1">sv</span><span class="dl">'</span><span class="p">).</span><span class="nx">compare</span><span class="p">;</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span>
    <span class="nx">firstBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">cmp</span><span class="p">:</span> <span class="nx">swedishCompare</span><span class="p">})</span>
<span class="p">);</span>
</code></pre></div></div>
<p>Check the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator">details on using Intl.Collator</a>.</p>

<h2 id="a-word-on-performance">A word on performance</h2>
<p>thenBy constructs a comparer function for you. It does this by combining the functions you pass in with a number of small utility functions that perform tasks like “reverting”, “combining the current sort order with the previous one”, etc. Also, these operations try to work correctly, no matter what content is in the sorted array. There are two steps here that cost time: constructing the über-function and running it. The construction time should always be negligible. The run time however can be slower than when you carefully handcraft the compare function. Still, <em>normally you shouldn’t worry about this</em>, but if you’re sorting very large sets, it could matter. For example, there is some overhead in making several small functions call each other instead of creating one piece of code. Also, if you know your data well, and know that a specific field is <em>alwways present</em> and is <em>always a number</em>, you could code a significantly faster compare function then thenBy’s results. The unit tests contain an extreme example.</p>

<p>If you use thenBy to combine multiple compare functions into one (where each function expects two parameters), the difference is small. Using unary functions adds some overhead, using direction:desc adds some, using only a property name adds a little, but will check for missing values, which could be optimized. Ignoring case will slow down, but not more so than when handcoded.</p>

<h2 id="installing">Installing</h2>
<h3 id="install-in-your-html">Install in your HTML</h3>
<p>To include it into your page/project, just paste the minified code from https://raw.github.com/Teun/thenBy.js/master/thenBy.min.js into yours (699 characters). If you don’t want the <code class="language-plaintext highlighter-rouge">firstBy</code> function in your global namespace, you can assign it to a local variable (see sample.htm).</p>

<h3 id="install-using-npm-or-yarn">Install using npm or yarn</h3>
<p><code class="language-plaintext highlighter-rouge">npm install thenby</code></p>

<p>or</p>

<p><code class="language-plaintext highlighter-rouge">yarn add thenby</code></p>

<p>then in your app:</p>

<p><code class="language-plaintext highlighter-rouge">var firstBy = require('thenby');</code></p>

<p>or in TypeScript/ES6:</p>

<p><code class="language-plaintext highlighter-rouge">import {firstBy} from "thenby";</code></p>

<p>For a small demo of how TypeScript support looks in a good editor (i.e. VS Code), <a href="https://youtu.be/mKJovFLyxro">check this short video</a>.</p>

<p>Thanks a lot to <a href="https://github.com/bergus">bergus</a>, <a href="https://github.com/hagabaka">hagabaka</a>, <a href="https://github.com/infolyzer">infolyzer</a> and <a href="https://github.com/Foxhoundn">Foxhoundn</a> for their improvements.
Thanks to <a href="https://github.com/jsgoupil">jsgoupil</a> and <a href="https://github.com/HonoluluHenk">HonoluluHenk</a> for their help on the TypeScript declaration.</p>


  </body>
</html>
